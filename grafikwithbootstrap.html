<!DOCTYPE html>
<html>

<head>
    <title>Grafik Temperatur, Probabilitas Presipitasi, Tekanan Udara dan Tutupan Awan</title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <style>
        /* Set height of plot container */
        #plot {
            height: 400px;
        }
    </style>
</head>

<body>

    <div class="container mt-5">
        <div class="row">
            <div class="col-md-12">
                <h1 class="text-center mb-4">Grafik Temperatur, Probabilitas Presipitasi, Tekanan Udara dan Tutupan Awan</h1>
                <div id="plot"></div>
            </div>
        </div>
    </div>

    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <script>
        // Data dari API
        var url = 'https://api.open-meteo.com/v1/forecast?latitude=-0.46&longitude=117.14&hourly=temperature_2m,precipitation_probability,surface_pressure,cloudcover,vapor_pressure_deficit&forecast_days=3&timezone=Asia%2FSingapore';

        // Ambil data dari API
        fetch(url)
            .then(response => response.json())
            .then(data => {
                // Ambil data temperatur 2 meter
                var temperatures = data['hourly']['temperature_2m'].slice(0, 72);

                // Ambil data probabilitas presipitasi
                var precipitation_probabilities = data['hourly']['precipitation_probability'].slice(0, 72);

                // Ambil data tekanan udara
                var surface_pressures = data['hourly']['surface_pressure'].slice(0, 72);

                // Ambil data tutupan awan
                var cloud_cover = data['hourly']['cloudcover'].slice(0, 72);

                // Mengatur sumbu x dengan jam
                var hours = Array.from({
                    length: 72
                }, (_, i) => i + 1);

                // Data untuk plot temperatur 2m
                var trace1 = {
                    x: hours,
                    y: temperatures.map(temp => temp / 55),
                    name: 'Temperatur (Â°C)',
                    mode: 'lines',
                    type: 'scatter',
                    line: {
                        color: 'orange'
                    }
                };

                // Data untuk plot probabilitas presipitasi
                var trace2 = {
                    x: hours,
                    y: precipitation_probabilities.map(prob => prob / 97.5),
                    name: 'Probabilitas Presipitasi (%)',
                    mode: 'lines',
                    type: 'scatter',
                    line: {
                        color: 'blue'
                    }
                };

                // Data untuk plot tekanan udara
                var trace3 = {
                    x: hours,
                    y: surface_pressures.map(pressure => pressure / 2000),
                    name: 'Tekanan Udara (hPa)',
                    mode: 'lines',
                    type: 'scatter',
                    line: {
                        color: 'black'
                    }
                };
				
				// Data untuk plot tutupan awan
                var trace4 = {
                    x: hours,
                    y: cloud_cover.map(cover => cover / 120),
                    name: 'Tutupan Awan (%)',
                    mode: 'lines',
                    type: 'scatter',
                    line: {
                        color: 'green'
                    }
                };
				
				var now = new Date();
				var skrg = now.getHours() + '.' + now.getMinutes();

				var garis = {
					x: [skrg, skrg],
					y: [0, 1],
					name: 'Waktu saat ini',
					mode: 'lines',
					type: 'line',
					line: {color: 'red', dash: 'dash', width : 1}
				};
				var garis24 = {
					x: [24, 24],
					y: [0, 1],
					name: 'Jam 24',
					mode: 'lines',
					type: 'line',
					line: {color: 'grey', dash: 'solid', width : 1}
				};
				var garis48 = {
					x: [48, 48],
					y: [0, 1],
					name: 'Jam 48',
					mode: 'lines',
					type: 'line',
					line: {color: 'grey', dash: 'solid', width : 1}
				};

                // Mengatur layout plot
                var layout = {
                    title: 'Kota Samarinda',
                    xaxis: {
                        title: 'Jam',
                        tickvals: hours,
                        ticktext: hours.map(hour => hour + ':00'), // Format tick text sebagai jam
                    },
                    yaxis: {
                        title: 'Skala Normalisasi',
                        range: [0, 1], // Mengatur skala y antara 0 dan 1
                    },
                    showlegend: true, // Menampilkan legenda
                    legend: {
                        x: 0.7,
                        y: 0.95,
                    },
                    margin: {
                        t: 50, // Margin atas
                        b: 50, // Margin bawah
                    },
                };

                // Menyusun data plot dalam array
                var data = [trace1, trace2, trace3, trace4, garis, garis24, garis48];

                // Membuat plot menggunakan Plotly
                Plotly.newPlot('plot', data, layout);
            })
            .catch(error => console.error('Error:', error));
    </script>
</body>
</html>
